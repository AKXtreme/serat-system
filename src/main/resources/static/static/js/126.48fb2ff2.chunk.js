"use strict";(self.webpackChunkserat_frontend=self.webpackChunkserat_frontend||[]).push([[126],{6745:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C});var d=a(5043),r=a(5206),n=a(9073),l=a(1645),s=a(3427),i=a(5444),c=a(1118),o=a(2019),p=a(2751),m=a(647),h=a(7419),x=a(6497),u=a(6051),A=a(1005),j=a(6399),y=a(859),I=a(7990),g=a(1966),k=a(7407),f=a(5337),w=a(617),D=a(9621),v=a(579);const{Search:b}=i.A,{Option:N}=x.A,C=()=>{const[e,t]=(0,d.useState)([]),[a,C]=(0,d.useState)(!1),[S,E]=(0,d.useState)(!1),[F,T]=(0,d.useState)("add"),[P,z]=(0,d.useState)(null),[$,q]=(0,d.useState)(""),[L]=s.A.useForm();(0,d.useEffect)(()=>{O()},[]);const O=async()=>{C(!0);try{const e=await D.mq.getDepartments();200===e.data.code&&t(e.data.data||[])}catch(e){o.Ay.error("Failed to fetch departments")}finally{C(!1)}},R=e=>{T("edit"),z(e),L.setFieldsValue({...e,parentId:0===e.parentId?void 0:e.parentId}),E(!0)},K=async e=>{try{const t=await D.mq.deleteDepartment(e);200===t.data.code?(o.Ay.success("Department deleted successfully"),O()):o.Ay.error(t.data.msg||"Failed to delete department")}catch(t){o.Ay.error("Failed to delete department")}},V=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.filter(e=>e.parentId===t).map(t=>({title:t.deptName,value:t.deptId,key:t.deptId,children:V(e,t.deptId)}))},Y=e.filter(e=>$?e.deptName.toLowerCase().includes($.toLowerCase())&&0===e.parentId:0===e.parentId),_=[{title:"Department ID",dataIndex:"deptId",key:"deptId",width:100},{title:"Department Name",dataIndex:"deptName",key:"deptName",render:(t,a)=>(0,v.jsxs)(u.A,{children:[(0,v.jsx)(I.A,{style:{color:"#1890ff"}}),t,e.filter(e=>e.parentId===a.deptId).length>0&&(0,v.jsxs)(j.A,{color:"blue",children:[e.filter(e=>e.parentId===a.deptId).length," sub-depts"]})]})},{title:"Order",dataIndex:"orderNum",key:"orderNum",width:80,sorter:(e,t)=>e.orderNum-t.orderNum},{title:"Leader",dataIndex:"leader",key:"leader",render:e=>e||"-"},{title:"Phone",dataIndex:"phone",key:"phone",render:e=>e||"-"},{title:"Email",dataIndex:"email",key:"email",render:e=>e||"-"},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,v.jsx)(j.A,{color:"0"===e?"green":"red",children:"0"===e?"Active":"Inactive"})},{title:"Create Time",dataIndex:"createTime",key:"createTime",width:180},{title:"Actions",key:"actions",width:200,render:(e,t)=>(0,v.jsxs)(u.A,{size:"small",children:[(0,v.jsx)(r.Ay,{type:"link",icon:(0,v.jsx)(k.A,{}),onClick:()=>R(t),children:"Edit"}),(0,v.jsx)(m.A,{title:"Delete Department",description:"Are you sure you want to delete this department and all its sub-departments?",onConfirm:()=>K(t.deptId),okText:"Yes",cancelText:"No",children:(0,v.jsx)(r.Ay,{type:"link",danger:!0,icon:(0,v.jsx)(g.A,{}),children:"Delete"})})]})}];return(0,v.jsxs)("div",{children:[(0,v.jsx)(n.A,{title:"Department Management",style:{marginBottom:16},children:(0,v.jsxs)(h.A,{gutter:[16,16],justify:"space-between",align:"middle",children:[(0,v.jsx)(l.A,{span:8,children:(0,v.jsx)(b,{placeholder:"Search departments",value:$,onChange:e=>q(e.target.value),style:{width:"100%"}})}),(0,v.jsx)(l.A,{children:(0,v.jsxs)(u.A,{children:[(0,v.jsx)(r.Ay,{type:"primary",icon:(0,v.jsx)(f.A,{}),onClick:()=>{T("add"),z(null),L.resetFields(),E(!0)},children:"Add Department"}),(0,v.jsx)(r.Ay,{icon:(0,v.jsx)(w.A,{}),onClick:O,children:"Refresh"})]})})]})}),(0,v.jsx)(n.A,{children:(0,v.jsx)(A.A,{columns:_,dataSource:Y,rowKey:"deptId",loading:a,expandable:{expandedRowRender:t=>{const a=e.filter(e=>e.parentId===t.deptId);if(0===a.length)return(0,v.jsx)("div",{style:{padding:"8px 0",color:"#999"},children:"No sub-departments"});const d=[{title:"Department Name",dataIndex:"deptName",key:"deptName",render:e=>(0,v.jsxs)(u.A,{children:[(0,v.jsx)(I.A,{style:{color:"#1890ff"}}),e]})},{title:"Leader",dataIndex:"leader",key:"leader"},{title:"Phone",dataIndex:"phone",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,v.jsx)(j.A,{color:"0"===e?"green":"red",children:"0"===e?"Active":"Inactive"})},{title:"Actions",key:"actions",width:200,render:(e,t)=>(0,v.jsxs)(u.A,{size:"small",children:[(0,v.jsx)(r.Ay,{type:"link",icon:(0,v.jsx)(k.A,{}),onClick:()=>R(t),size:"small",children:"Edit"}),(0,v.jsx)(m.A,{title:"Delete Department",description:"Are you sure you want to delete this department?",onConfirm:()=>K(t.deptId),okText:"Yes",cancelText:"No",children:(0,v.jsx)(r.Ay,{type:"link",danger:!0,icon:(0,v.jsx)(g.A,{}),size:"small",children:"Delete"})})]})}];return(0,v.jsx)(A.A,{columns:d,dataSource:a,rowKey:"deptId",pagination:!1,size:"small"})},rowExpandable:t=>e.filter(e=>e.parentId===t.deptId).length>0},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`}})}),(0,v.jsx)(p.A,{title:"add"===F?"Add Department":"Edit Department",visible:S,onOk:async()=>{try{const e=await L.validateFields(),t={...e,deptId:"edit"===F?P.deptId:void 0,parentId:e.parentId||0};let a;a="add"===F?await D.mq.createDepartment(t):await D.mq.updateDepartment(t),200===a.data.code?(o.Ay.success(`Department ${"add"===F?"created":"updated"} successfully`),E(!1),O()):o.Ay.error(a.data.msg||`Failed to ${F} department`)}catch(e){o.Ay.error(`Failed to ${F} department`)}},onCancel:()=>E(!1),width:700,okText:"add"===F?"Create":"Update",children:(0,v.jsxs)(s.A,{form:L,layout:"vertical",initialValues:{status:"0",orderNum:0},children:[(0,v.jsxs)(h.A,{gutter:16,children:[(0,v.jsx)(l.A,{span:12,children:(0,v.jsx)(s.A.Item,{name:"deptName",label:"Department Name",rules:[{required:!0,message:"Please input department name!"},{min:2,max:30,message:"Department name must be 2-30 characters!"}],children:(0,v.jsx)(i.A,{placeholder:"Enter department name"})})}),(0,v.jsx)(l.A,{span:12,children:(0,v.jsx)(s.A.Item,{name:"parentId",label:"Parent Department",children:(0,v.jsx)(y.A,{style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:V(e),placeholder:"Select parent department (optional)",treeDefaultExpandAll:!0,allowClear:!0})})})]}),(0,v.jsxs)(h.A,{gutter:16,children:[(0,v.jsx)(l.A,{span:12,children:(0,v.jsx)(s.A.Item,{name:"orderNum",label:"Display Order",rules:[{required:!0,message:"Please input display order!"}],children:(0,v.jsx)(c.A,{min:0,max:9999,placeholder:"Enter display order",style:{width:"100%"}})})}),(0,v.jsx)(l.A,{span:12,children:(0,v.jsx)(s.A.Item,{name:"leader",label:"Department Leader",children:(0,v.jsx)(i.A,{placeholder:"Enter department leader"})})})]}),(0,v.jsxs)(h.A,{gutter:16,children:[(0,v.jsx)(l.A,{span:12,children:(0,v.jsx)(s.A.Item,{name:"phone",label:"Contact Phone",rules:[{pattern:/^1[3-9]\d{9}$/,message:"Please enter a valid phone number!"}],children:(0,v.jsx)(i.A,{placeholder:"Enter contact phone"})})}),(0,v.jsx)(l.A,{span:12,children:(0,v.jsx)(s.A.Item,{name:"email",label:"Contact Email",rules:[{type:"email",message:"Please enter a valid email!"}],children:(0,v.jsx)(i.A,{placeholder:"Enter contact email"})})})]}),(0,v.jsx)(h.A,{gutter:16,children:(0,v.jsx)(l.A,{span:24,children:(0,v.jsx)(s.A.Item,{name:"status",label:"Status",children:(0,v.jsxs)(x.A,{children:[(0,v.jsx)(N,{value:"0",children:"Active"}),(0,v.jsx)(N,{value:"1",children:"Inactive"})]})})})})]})})]})}}}]);
//# sourceMappingURL=126.48fb2ff2.chunk.js.map