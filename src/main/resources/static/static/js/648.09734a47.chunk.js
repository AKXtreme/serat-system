"use strict";(self.webpackChunkserat_frontend=self.webpackChunkserat_frontend||[]).push([[648],{6648:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var r=a(5043),l=a(5206),s=a(9073),d=a(1645),n=a(3427),o=a(5444),i=a(2019),c=a(2751),u=a(647),h=a(7419),m=a(6497),A=a(6051),x=a(1005),y=a(6399),j=a(283),p=a(1966),k=a(7407),S=a(5337),g=a(617),I=a(4228),w=a(3722),v=a(9621),f=a(579);const{Search:R}=o.A,{Option:C}=m.A,b=()=>{const[e,t]=(0,r.useState)([]),[a,b]=(0,r.useState)([]),[F,D]=(0,r.useState)(!1),[N,q]=(0,r.useState)({current:1,pageSize:10,total:0}),[P,T]=(0,r.useState)({}),[E,K]=(0,r.useState)(!1),[$,z]=(0,r.useState)(!1),[O,M]=(0,r.useState)("add"),[U,V]=(0,r.useState)(null),[_,B]=(0,r.useState)([]),[J]=n.A.useForm();(0,r.useEffect)(()=>{Q(),Y()},[N.current,N.pageSize,P]);const Q=async()=>{D(!0);try{const e=await v.mq.getRoles({pageNum:N.current,pageSize:N.pageSize,...P});200===e.data.code&&(t(e.data.rows||[]),q(t=>({...t,total:e.data.total||0})))}catch(e){i.Ay.error("Failed to fetch roles")}finally{D(!1)}},Y=async()=>{try{const e=await v.mq.getMenus();200===e.data.code&&b(e.data.data||[])}catch(e){console.error("Failed to fetch menus:",e)}},G=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.filter(e=>e.parentId===t).map(t=>({title:t.menuName,key:t.menuId,children:G(e,t.menuId)}))},H=[{title:"Role ID",dataIndex:"roleId",key:"roleId",width:80},{title:"Role Name",dataIndex:"roleName",key:"roleName",render:e=>(0,f.jsxs)(A.A,{children:[(0,f.jsx)(I.A,{}),e]})},{title:"Role Key",dataIndex:"roleKey",key:"roleKey",render:e=>(0,f.jsx)(y.A,{color:"blue",children:e})},{title:"Sort Order",dataIndex:"roleSort",key:"roleSort",width:100},{title:"Data Scope",dataIndex:"dataScope",key:"dataScope",render:e=>(0,f.jsx)(y.A,{color:"green",children:{1:"All data",2:"Custom data",3:"Department data",4:"Department and sub-department data",5:"Personal data only"}[e]||"Unknown"})},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,f.jsx)(y.A,{color:"0"===e?"green":"red",children:"0"===e?"Active":"Inactive"})},{title:"Create Time",dataIndex:"createTime",key:"createTime",width:180},{title:"Actions",key:"actions",width:300,render:(e,t)=>(0,f.jsxs)(A.A,{size:"small",children:[(0,f.jsx)(l.Ay,{type:"link",icon:(0,f.jsx)(k.A,{}),onClick:()=>(e=>{M("edit"),V(e),J.setFieldsValue(e),K(!0)})(t),children:"Edit"}),(0,f.jsx)(l.Ay,{type:"link",icon:(0,f.jsx)(w.A,{}),onClick:()=>(e=>{V(e),B(e.menuIds||[]),z(!0)})(t),children:"Permissions"}),(0,f.jsx)(u.A,{title:"Delete Role",description:"Are you sure you want to delete this role?",onConfirm:()=>(async e=>{try{const t=await v.mq.deleteRole(e);200===t.data.code?(i.Ay.success("Role deleted successfully"),Q()):i.Ay.error(t.data.msg||"Failed to delete role")}catch(t){i.Ay.error("Failed to delete role")}})(t.roleId),okText:"Yes",cancelText:"No",children:(0,f.jsx)(l.Ay,{type:"link",danger:!0,icon:(0,f.jsx)(p.A,{}),children:"Delete"})})]})}];return(0,f.jsxs)("div",{children:[(0,f.jsx)(s.A,{title:"Role Management",style:{marginBottom:16},children:(0,f.jsxs)(h.A,{gutter:[16,16],justify:"space-between",align:"middle",children:[(0,f.jsx)(d.A,{span:8,children:(0,f.jsx)(R,{placeholder:"Search by role name",onSearch:e=>{T({roleName:e}),q(e=>({...e,current:1}))},style:{width:"100%"}})}),(0,f.jsx)(d.A,{children:(0,f.jsxs)(A.A,{children:[(0,f.jsx)(l.Ay,{type:"primary",icon:(0,f.jsx)(S.A,{}),onClick:()=>{M("add"),V(null),J.resetFields(),K(!0)},children:"Add Role"}),(0,f.jsx)(l.Ay,{icon:(0,f.jsx)(g.A,{}),onClick:Q,children:"Refresh"})]})})]})}),(0,f.jsx)(s.A,{children:(0,f.jsx)(x.A,{columns:H,dataSource:e,rowKey:"roleId",loading:F,pagination:{...N,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`},onChange:e=>{q(e)}})}),(0,f.jsx)(c.A,{title:"add"===O?"Add Role":"Edit Role",visible:E,onOk:async()=>{try{const e={...await J.validateFields(),roleId:"edit"===O?U.roleId:void 0};let t;t="add"===O?await v.mq.createRole(e):await v.mq.updateRole(e),200===t.data.code?(i.Ay.success(`Role ${"add"===O?"created":"updated"} successfully`),K(!1),Q()):i.Ay.error(t.data.msg||`Failed to ${O} role`)}catch(e){i.Ay.error(`Failed to ${O} role`)}},onCancel:()=>K(!1),width:600,okText:"add"===O?"Create":"Update",children:(0,f.jsxs)(n.A,{form:J,layout:"vertical",initialValues:{status:"0",dataScope:"1",menuCheckStrictly:!0,deptCheckStrictly:!0},children:[(0,f.jsxs)(h.A,{gutter:16,children:[(0,f.jsx)(d.A,{span:12,children:(0,f.jsx)(n.A.Item,{name:"roleName",label:"Role Name",rules:[{required:!0,message:"Please input role name!"}],children:(0,f.jsx)(o.A,{placeholder:"Enter role name"})})}),(0,f.jsx)(d.A,{span:12,children:(0,f.jsx)(n.A.Item,{name:"roleKey",label:"Role Key",rules:[{required:!0,message:"Please input role key!"}],children:(0,f.jsx)(o.A,{placeholder:"Enter role key"})})})]}),(0,f.jsxs)(h.A,{gutter:16,children:[(0,f.jsx)(d.A,{span:12,children:(0,f.jsx)(n.A.Item,{name:"roleSort",label:"Sort Order",rules:[{required:!0,message:"Please input sort order!"}],children:(0,f.jsx)(o.A,{type:"number",placeholder:"Enter sort order"})})}),(0,f.jsx)(d.A,{span:12,children:(0,f.jsx)(n.A.Item,{name:"status",label:"Status",children:(0,f.jsxs)(m.A,{children:[(0,f.jsx)(C,{value:"0",children:"Active"}),(0,f.jsx)(C,{value:"1",children:"Inactive"})]})})})]}),(0,f.jsx)(h.A,{gutter:16,children:(0,f.jsx)(d.A,{span:24,children:(0,f.jsx)(n.A.Item,{name:"dataScope",label:"Data Scope",children:(0,f.jsxs)(m.A,{children:[(0,f.jsx)(C,{value:"1",children:"All data"}),(0,f.jsx)(C,{value:"2",children:"Custom data"}),(0,f.jsx)(C,{value:"3",children:"Department data"}),(0,f.jsx)(C,{value:"4",children:"Department and sub-department data"}),(0,f.jsx)(C,{value:"5",children:"Personal data only"})]})})})}),(0,f.jsx)(h.A,{gutter:16,children:(0,f.jsx)(d.A,{span:24,children:(0,f.jsx)(n.A.Item,{name:"remark",label:"Remark",children:(0,f.jsx)(o.A.TextArea,{rows:4,placeholder:"Enter remark"})})})})]})}),(0,f.jsx)(c.A,{title:`Assign Permissions - ${null===U||void 0===U?void 0:U.roleName}`,visible:$,onOk:async()=>{try{const e=await v.mq.updateRoleMenus({roleId:U.roleId,menuIds:_});200===e.data.code?(i.Ay.success("Permissions updated successfully"),z(!1),Q()):i.Ay.error(e.data.msg||"Failed to update permissions")}catch(e){i.Ay.error("Failed to update permissions")}},onCancel:()=>z(!1),width:500,okText:"Save Permissions",children:(0,f.jsx)(j.A,{checkable:!0,checkedKeys:_,onCheck:B,treeData:G(a),height:400})})]})}}}]);
//# sourceMappingURL=648.09734a47.chunk.js.map