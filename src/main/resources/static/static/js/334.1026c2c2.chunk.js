"use strict";(self.webpackChunkserat_frontend=self.webpackChunkserat_frontend||[]).push([[334],{3334:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var s=r(5043),o=r(5206),a=r(9073),l=r(1645),n=r(9372),i=r(691),d=r(5444),c=r(2019),p=r(2751),m=r(7419),u=r(6497),x=r(6051),h=r(1005),y=r(6399),j=r(5885),I=r(6191),A=r(617),g=r(9621),b=r(6178),T=r.n(b),f=r(579);const{Search:w}=d.A,{RangePicker:k}=n.A,{Option:S}=u.A,C=()=>{const[e,t]=(0,s.useState)([]),[r,n]=(0,s.useState)(!1),[d,u]=(0,s.useState)(""),[b,k]=(0,s.useState)(null),[S,C]=(0,s.useState)(!1);(0,s.useEffect)(()=>{N()},[]);const N=async()=>{n(!0);try{const e=await g.Bn.getOperationLogs();200===e.data.code&&t(e.data.rows||[])}catch(e){c.Ay.error("Failed to fetch operation logs")}finally{n(!1)}},O=e=>0===e?"green":"red",L=e=>0===e?"Success":"Failed",R=e=>({1:"blue",2:"green",3:"red",4:"orange",5:"purple",6:"cyan",7:"gold",8:"lime",9:"magenta"}[e]||"default"),M=e=>({1:"Insert",2:"Update",3:"Delete",4:"Grant",5:"Export",6:"Import",7:"Force Logout",8:"Generate Code",9:"Clear Data"}[e]||"Other"),P=(e.length>0?e:[{operId:1,title:"User Management",businessType:"2",method:"com.a.map.controller.system.SysUserController.edit()",requestMethod:"PUT",operatorType:"1",operName:"admin",deptName:"IT Department",operUrl:"/system/user",operIp:"192.168.1.100",operLocation:"Internal Network",operParam:'{"userId":1,"userName":"admin","status":"0"}',jsonResult:'{"code":200,"msg":"success"}',status:0,errorMsg:"",operTime:"2025-01-24 15:30:25",costTime:156},{operId:2,title:"Role Management",businessType:"1",method:"com.a.map.controller.system.SysRoleController.add()",requestMethod:"POST",operatorType:"1",operName:"admin",deptName:"IT Department",operUrl:"/system/role",operIp:"192.168.1.100",operLocation:"Internal Network",operParam:'{"roleName":"Test Role","roleKey":"test"}',jsonResult:'{"code":200,"msg":"success"}',status:0,errorMsg:"",operTime:"2025-01-24 15:25:10",costTime:89}]).filter(e=>!d||(e.title.toLowerCase().includes(d.toLowerCase())||e.operName.toLowerCase().includes(d.toLowerCase())||e.operIp.includes(d))),U=[{title:"Operation ID",dataIndex:"operId",key:"operId",width:100},{title:"System Module",dataIndex:"title",key:"title"},{title:"Operation Type",dataIndex:"businessType",key:"businessType",render:e=>(0,f.jsx)(y.A,{color:R(e),children:M(e)})},{title:"Operator",dataIndex:"operName",key:"operName"},{title:"Department",dataIndex:"deptName",key:"deptName",render:e=>e||"-"},{title:"IP Address",dataIndex:"operIp",key:"operIp"},{title:"Location",dataIndex:"operLocation",key:"operLocation"},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,f.jsx)(y.A,{color:O(e),children:L(e)})},{title:"Operation Time",dataIndex:"operTime",key:"operTime",width:180,sorter:(e,t)=>T()(e.operTime).unix()-T()(t.operTime).unix()},{title:"Cost Time",dataIndex:"costTime",key:"costTime",render:e=>`${e}ms`,sorter:(e,t)=>e.costTime-t.costTime},{title:"Actions",key:"actions",width:120,render:(e,t)=>(0,f.jsx)(x.A,{size:"small",children:(0,f.jsx)(o.Ay,{type:"link",icon:(0,f.jsx)(I.A,{}),onClick:()=>(e=>{k(e),C(!0)})(t),size:"small",children:"View"})})}];return(0,f.jsxs)("div",{children:[(0,f.jsx)(a.A,{title:"Operation Logs",style:{marginBottom:16},children:(0,f.jsxs)(m.A,{gutter:[16,16],justify:"space-between",align:"middle",children:[(0,f.jsx)(l.A,{span:8,children:(0,f.jsx)(w,{placeholder:"Search by module, operator, or IP",value:d,onChange:e=>u(e.target.value),style:{width:"100%"}})}),(0,f.jsx)(l.A,{children:(0,f.jsxs)(x.A,{children:[(0,f.jsx)(o.Ay,{icon:(0,f.jsx)(j.A,{}),onClick:async()=>{try{const e=await g.Bn.exportOperationLogs(),t=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=t,r.setAttribute("download","operation_logs.xlsx"),document.body.appendChild(r),r.click(),r.remove(),c.Ay.success("Export successful")}catch(e){c.Ay.error("Export failed")}},children:"Export"}),(0,f.jsx)(o.Ay,{icon:(0,f.jsx)(A.A,{}),onClick:N,children:"Refresh"})]})})]})}),(0,f.jsx)(a.A,{children:(0,f.jsx)(h.A,{columns:U,dataSource:P,rowKey:"operId",loading:r,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`}})}),b&&(0,f.jsx)(p.A,{title:"Operation Log Details",visible:S,onCancel:()=>C(!1),footer:[(0,f.jsx)(o.Ay,{onClick:()=>C(!1),children:"Close"},"close")],width:800,children:(0,f.jsxs)(i.A,{bordered:!0,column:2,children:[(0,f.jsx)(i.A.Item,{label:"Operation ID",children:b.operId}),(0,f.jsx)(i.A.Item,{label:"System Module",children:b.title}),(0,f.jsx)(i.A.Item,{label:"Operation Type",children:(0,f.jsx)(y.A,{color:R(b.businessType),children:M(b.businessType)})}),(0,f.jsx)(i.A.Item,{label:"Request Method",children:(0,f.jsx)(y.A,{color:"blue",children:b.requestMethod})}),(0,f.jsx)(i.A.Item,{label:"Operator",children:b.operName}),(0,f.jsx)(i.A.Item,{label:"Department",children:b.deptName||"-"}),(0,f.jsx)(i.A.Item,{label:"Request URL",span:2,children:(0,f.jsx)("code",{children:b.operUrl})}),(0,f.jsx)(i.A.Item,{label:"IP Address",children:b.operIp}),(0,f.jsx)(i.A.Item,{label:"Location",children:b.operLocation}),(0,f.jsx)(i.A.Item,{label:"Status",children:(0,f.jsx)(y.A,{color:O(b.status),children:L(b.status)})}),(0,f.jsxs)(i.A.Item,{label:"Cost Time",children:[b.costTime,"ms"]}),(0,f.jsx)(i.A.Item,{label:"Operation Time",span:2,children:b.operTime}),(0,f.jsx)(i.A.Item,{label:"Method Name",span:2,children:(0,f.jsx)("code",{style:{fontSize:"12px"},children:b.method})}),(0,f.jsx)(i.A.Item,{label:"Request Parameters",span:2,children:(0,f.jsx)("pre",{style:{background:"#f5f5f5",padding:"8px",borderRadius:"4px",fontSize:"12px",maxHeight:"200px",overflow:"auto"},children:JSON.stringify(JSON.parse(b.operParam||"{}"),null,2)})}),(0,f.jsx)(i.A.Item,{label:"Response Result",span:2,children:(0,f.jsx)("pre",{style:{background:"#f5f5f5",padding:"8px",borderRadius:"4px",fontSize:"12px",maxHeight:"200px",overflow:"auto"},children:JSON.stringify(JSON.parse(b.jsonResult||"{}"),null,2)})}),b.errorMsg&&(0,f.jsx)(i.A.Item,{label:"Error Message",span:2,children:(0,f.jsx)("div",{style:{color:"red"},children:b.errorMsg})})]})})]})}}}]);
//# sourceMappingURL=334.1026c2c2.chunk.js.map